<html>
  <head>
    <title>A Cyber-Physical Topology Language (CPTL) - Queries</title>
    <link type="text/css" rel="stylesheet" href="css/episteme.css"/>
  </head>
  <body>
    <div id="wrapper">
      <div id="navigation">
	<a href="index.html">Home</a> 
	| <a href="catalog.html">Catalog</a>
	| <a href="queries.html">Queries</a>
      </div>

      <h1>Querying Cyber-Physical Constructs within a Graph Database</h1>
      <p>We now want to discuss how to query the cyber-physical
      constructs defined within our <a href="catalog.html">CPTL
      catalog</a>.  Currently, this is a two-step transformation
      process.  First, we convert the GraphML schematic into an
      intermediate <em>Abstract Syntax Language (ASL)</em> that
      captures relations that are implicit in the schematic.  (We note
      that although some of the representations aren't really trees if
      we include the CPTL relations such as<em>hasLink</em>, they are
      trees when we only look at ASL relations such
      as <em>hasVariable</em>, <em>hasType</em>,
      and <em>hasName</em>).  Second, we convert the ASL construct
      into a Neo4j Cypher CREATE statement.  We now discuss both
      components of this process.</p>


      <h2>Converting Schematics into ASL</h2>
      <p>The schematics from our catalog encode implicit relations
      that we may want to query.  Consider, for example, the breaker
      installation schematic shown below.</p>

      <div class="figure">
	<p><img src="images/schematic/BreakerInstallation.detail.png"/></p>
	<p>More detailed of the Breaker installation schematic.</p>
      </div>

      <p>Although the schematic visually shows us that a Breaker
      Installation construct consists of a Breaker attached to two
      lines, there is an implicit relation, denoted by containment
      that a Breaker installation has three variables: Line L1, Line
      L2, and Breaker B.  Our ASL captures these implicit relations
      within the schematic that are encoded by containment.
      Consider, for example, the corresponding ASL representation
      for the Breaker installation shown above.</p> 

      <div class="figure">
	<p><img src="images/asl/BreakerInstallation.png"/></p>
	<p>The ASL representation of the Breaker installation data model.</p>
      </div>

      <p>Specifically, we see that the breaker installation (shown at
      the far left) has three variables which have the names L1, B,
      and L2 and types of Line, Breaker, and Line respectively.
      Furthermore, the CPTL relation <em>hasLink</em> is also encoded
      within the ASL representation of the construction.</p>

      <p>Practically, we can convert the
      construct <a href="../data/graphs/constructions/schematic">schematics</a>
      into their
      corresponding <a href="../data/graphs/constructions/asl">ASL
      representations</a> by using the <em>schematic2asl</em>
      Makefile task.

      <h2>Loading Constructs into the GraphDB</h2>
      <p>After we have the ASL GraphML representation of the
      constructs, we can convert them into a Neo4j Cypher CREATE
      query.  For example, we convert the ASL above into the
      following <a href="../data/graphs/constructions/cypher/BreakerInstallation.db">Neo4j
      Cypher CREATE statement for a Breaker Installation</a>.  The
      figure below shows what this structure looks like in the Neo4j
      browser.</p>
      
      <div class="figure">
	<p><img src="images/cypher/BreakerInstallation.png"/></p>
	<p>View of the Breaker Installation construct within the Neo4j
	browser.</p>
      </div>
      
      <p>Practically, we can convert
      the <a href="../data/graphs/constructions/asl">ASL
      constructs</a> into their
      corresponding <a href="../data/graphs/constructions/cypher">Cypher
      CREATE statements</a> via the <em>asl2neo4j</em> Makefile task.
      Once we have done this, we can copy each of these statements
      into
      the <a href="http://blog.neo4j.org/2013/10/neo4j-200-m06-introducing-neo4js-browser.html">Neo4j
      browser</a> (usually running on localhost:7474) to populate the
      graph database.</p>
      

      <h2>Example Queries</h2>
      <p>Once we have loaded the constructs into the graph database,
      we are free to run queries on the structures therein.  We will
      now walk through a few example queries.</p>

      <h3>Retrieve Construct Templates</h3>
      <div class="figure">
	<p><img src="images/cypher/line_templates.queries.png"/></p>
	<p>Query to retrieve the Line template from the database.</p>
      </div>
      
      <div class="figure">
	<p><img src="images/cypher/templates.queries.png"/></p>
	<p>Query to retrieve all CPTL templates from the database.</p>
      </div>

      <div class="figure">
	<p><img src="images/cypher/templates_w_CT.queries.png"/></p>
	<p>Query to retrieve all CPTL templates that contain a Current
	Transformer.</p>
      </div>

      <div class="figure">
	<p><img src="images/cypher/templates_w_CT.detail.queries.png"/></p>
	<p>Drill-down within result set for query to retrieve all CPTL
	templates that contain a Current Transformer.</p>
      </div>

      <div width="70%" class="figure">
	<p><img src="images/cypher/breaker_control_paths.queries.png"/></p>
	<p>Return all paths of length at most 10 hops from a breaker
	control to a line within the ASL.  We see that the
	BreakerControlInstallation and RTUBreakerControlInstallation
	templates contain such paths.</p>
      </div>

      <div id="footer">
	<p>Page last modified:  March 19, 2014</p>
	<p>
	  <em class="title">CPTL:  always work in progress</em>
	  packaged on March 19, 2014.  Edited by and copyright
	  2013-2014 Gabriel A. Weaver except where otherwise noted.</p>

	<a rel="license"
	   href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative
	   Commons License" style="border-width:0"
	   src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"
	   /></a><br /><span xmlns:dct="http://purl.org/dc/terms/"
	   property="dct:title">CPTL Power Documentation</span> is licensed under a

	<a rel="license"
	   href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative
	  Commons Attribution-NonCommercial-ShareAlike 4.0 International
	  License</a>  (With that said, we are amenable to commercialization).

        <p>This site includes material that has not been reviewed or
        approved by anyone at University of Illinois at Urbana-Champaign.</p>
     </div>

    </div>
  </body>
</html>
